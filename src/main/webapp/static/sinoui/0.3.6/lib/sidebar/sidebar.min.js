//ds.base
(function(d,g,n){var q=/\{([^\}]*)\}/g,m=d.ds={noop:function(){},mix:function(b,a,e){"object"!==typeof a&&(e=a,a=b,b=this);for(var c in a)if(e||b[c]===n)b[c]=a[c];return b},mixStr:function(b){var a=Array.prototype.slice.call(arguments,1);return String(b).replace(q,function(b,c){return null!=a[c]?a[c]:b})},trim:function(b){return String(b).replace(/^\s*/,"").replace(/\s*$/,"")},getRndNum:function(b,a){a=isFinite(a)?a:0;return Math.random()*((isFinite(b)?b:1E3)-a)+a},scrollTo:function(){var b=$(d);return function(a,e){a=Math.max(0,~~a);var c=new Date,l=b.scrollTop(),f=a-l,h=function(){var b=new Date-c;if(480<=b)return d.scrollTo(0,a),(e||m.noop).call(m,a);var k=b/480,b=1>(k*=2)?.5*k*k:.5*(1- --k*(k-2));d.scrollTo(0,l+f*b);setTimeout(h,16)};h()}}(),loadScriptCache:{},loadScript:function(b,a,e){var c=this.loadScriptCache[b];if(!c){var c=this.loadScriptCache[b]={callbacks:[],url:b},d=g.getElementsByTagName("script")[0],f=g.createElement("script");if("object"===typeof e)for(var h in e)f[h]=e[h];f.src=b;f.onload=f.onreadystatechange=f.onerror=function(){if(/undefined|loaded|complete/.test(this.readyState)){f=f.onreadystatechange=f.onload=f.onerror=null;c.loaded=!0;for(var a=0,e=c.callbacks.length;a<e;a++)c.callbacks[a].call(null,b);c.callbacks=[]}};d.parentNode.insertBefore(f,d)}c.loaded?(a||m.noop).call(null,b):"function"===typeof a&&c.callbacks.push(a);return this},requestAnimationFrame:function(){var b=d.requestAnimationFrame||d.webkitRequestAnimationFrame||d.mozRequestAnimationFrame||d.msRequestAnimationFrame||d.oRequestAnimationFrame||function(a){return d.setTimeout(a,1E3/60)};return function(a){return b(a)}}(),animate:function(){var b=function(a){return Math.pow(a-1,3)+1};getCurrCSS=d.getComputedStyle?function(a,b){return d.getComputedStyle(a,null)[b]}:function(a,b){return a.currentStyle[b]};return function(a,e,c,d,f,h){function g(){var b=+new Date-n;if(b>=d)return l[e]=c+"px",(f||m.noop).call(a);l[e]=k+p*h(b/d)+"px";m.requestAnimationFrame(g)}var k=parseFloat(getCurrCSS(a,e))||0,l=a.style,n=new Date,p=0;c=parseFloat(c)||0;d=~~d||200;h=h||b;p=c-k;g();return this}}(),getCookie:function(b){return(b=(new RegExp("(?:^|[^;])"+b+"\x3d([^;]+)")).exec(g.cookie))?decodeURIComponent(b[1]):""},setCookie:function(b,a,d){b=b+"\x3d"+encodeURIComponent(a);void 0!==d&&(a=new Date,a.setDate(a.getDate()+~~d),b+="; expires\x3d"+a.toGMTString());g.cookie=b},transitionSupport:function(){for(var b,a=["","webkit","moz","ms","o"],d=(g.documentElement||g.body).style,c=0,l=a.length;c<l;c++)if(b=a[c]+(""!==a[c]?"Transition":"transition"),b in d)return{propName:b,prefix:a[c]};return null}(),isIE6:!1}})(this,document);
//ds.tmpl.js
;(function(global){var ds=global.ds||(global.ds={});var rarg1=/\$1/g,rgquote=/\\"/g,rbr=/([\r\n])/g,rchars=/(["\\])/g,rdbgstrich=/\\\\/g,rfuns=/<%\s*(\w+|.)([\s\S]*?)\s*%>/g,rbrhash={'10':'n','13':'r'},helpers={'=':{render:'__.push($1);'}};ds.tmpl=function(tmpl,data){var render=new Function('_data','var __=[];__.data=_data;'+'with(_data){__.push("'+tmpl.replace(rchars,'\\$1').replace(rfuns,function(a,key,body){body=body.replace(rbr,';').replace(rgquote,'"').replace(rdbgstrich,'\\');var helper=helpers[key],tmp=!helper?key+body:typeof helper.render==='function'?helper.render.call(ds,body,data):helper.render.replace(rarg1,body);return'");'+tmp+'__.push("';}).replace(rbr,function(a,b){return'\\'+(rbrhash[b.charCodeAt(0)]||b);})+'");}return __.join("");');return data?render.call(data,data):render;};ds.tmpl.helper=helpers;})(this);
// jquery.mask.js
;(function(global,document,$,undefined){var DOC=$(document),_noop=function(){},ds=global.ds||(global.ds={});var _uuid=0,_ops={id:null,anim:true,animDuration:320,zIndex:999,opacity:0.8,background:'#000',onshow:_noop,onhide:_noop,onclick:_noop},Mask=ds.Mask=function(ops){return this.init(ops);};Mask._cache={};Mask.prototype={constructor:Mask,init:function(ops){this.ops=ops=ops||{};$.each(_ops,function(k,val){typeof ops[k]==='undefined'&&(ops[k]=val);});var id=ops.id;if(typeof id!=='string'){id='ds_mask_'+(++_uuid);}this.id=id;if(Mask._cache[id]){var _mask=Mask._cache[id];_mask.ops=ops;return _mask;}Mask._cache[id]=this;return this;},_getElem:function(){var elem=this.elem,self=this;if(!elem){var ops=this.ops,css='border:0;margin:0;padding:0;height:100%;width:100%;left:0;top:0;opacity:0;';elem=this.elem=$(document.createElement('div'));elem.bind('click.jquery_mask',function(){self.ops.onclick.call(self);});elem[0].style.cssText=css+'display:none;position:fixed;background:'+ops.background+';z-index:'+ops.zIndex;if(!Mask.fixedPositionSupport()){elem[0].style.position='absolute';css+='position:absolute;filter:Alpha(opacity=0);';elem[0].innerHTML='<iframe src="javascript:false" frameborder="0" height="100%" width="100%" style="'+css+'z-index:1;"></iframe><div style="'+css+'background:#fff;z-index:9;"></div>';}elem[0].id=this.id;elem.appendTo('body');}return elem;},show:function(opacity){var self=this,ops=this.ops,elem=this._getElem();opacity=typeof opacity==='number'?opacity:ops.opacity;if(!Mask.fixedPositionSupport()){elem.css('height',DOC.height());}this.elem.css('background',ops.background).show();if(ops.anim){elem.stop().animate({opacity:opacity},ops.animDuration,function(){ops.onshow.call(self,opacity);});}else{elem.stop().css('opacity',opacity);ops.onshow.call(this,opacity);}return this;},hide:function(){var self=this,ops=this.ops,elem=this._getElem();if(ops.onhide.call(this)!==false){if(ops.anim){elem.stop().animate({opacity:0},ops.animDuration,function(){this.style.display='none';});}else{elem[0].style.display='none';}}return this;},destory:function(){if(this.elem){this.elem.remove();this.elem=null;}delete Mask._cache[this.id];}};Mask.fixedPositionSupport=function(){if(typeof $.support.fixedPosition==='boolean'){return $.support.fixedPosition;}var div,ret=false,body=document.body,css='border:0;margin:0;padding:0;position:fixed;left:0;top:20px;';if(body){div=document.createElement('div');div.style.cssText=css+'position:absolute;top:0;';div.innerHTML='<div style="'+css+'"></div>';body.insertBefore(div,body.firstChild);ret=$.support.fixedPosition=div.firstChild.offsetTop===20;body.removeChild(div);}return ret;};ds.mask=$.mask=function(opacity,background){var ops=typeof opacity==='object'?opacity:{opacity:opacity,background:background};ops.id='ds_global_mask';return new Mask(ops).show();};})(this,this.document,jQuery);
//ds.dialog.js
(function(p,q,f,n){var h=f(p),v=f(q),r=p.ds||(p.ds={}),x=0;n=function(){};var t={id:null,title:null,content:"",className:null,padding:"20px 25px",height:"auto",width:"auto",left:"50%",top:"40%",zIndex:1990,icon:null,iconBasePath:p.iconBasePath||"images/",buttons:null,follow:null,followOffset:null,autoOpen:!0,esc:!0,lock:!0,lockOpacity:.6,lockColor:"#000",showCloseButton:!0,drag:!0,fixed:!0,anim:!0,animDuration:320,timeout:0,oninit:n,onopen:n,onfocus:n,onmaskclick:n,onhide:n,onclose:n,yesText:"\u786e\u5b9a",noText:"\u53d6\u6d88",onyes:null,onno:null},d=r.Dialog=function(a){return this.init(a||{})};f.extend(d,{items:{},defaults:t,currIndex:1990,defaultTmpl:'\x3cdiv class\x3d"ds_dialog_outer"\x3e\x3ctable class\x3d"ds_dialog_border"\x3e\x3ctr\x3e\x3ctd class\x3d"ds_dialog_tl"\x3e\x3c/td\x3e\x3ctd class\x3d"ds_dialog_tc"\x3e\x3c/td\x3e\x3ctd class\x3d"ds_dialog_tr"\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd class\x3d"ds_dialog_ml"\x3e\x3c/td\x3e\x3ctd class\x3d"ds_dialog_mc"\x3e\x3cdiv class\x3d"ds_dialog_inner"\x3e\x3ctable class\x3d"ds_dialog_panel"\x3e\x3ctr\x3e\x3ctd colspan\x3d"2" class\x3d"ds_dialog_header"\x3e\x3cdiv class\x3d"ds_dialog_title"\x3e\x3ch3\x3e\x3c/h3\x3e\x3c/div\x3e\x3cdiv class\x3d"ds_dialog_close"\x3e\x3ca href\x3d"javascript:;"\x3e\u00d7\x3c/a\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd class\x3d"ds_dialog_icon" style\x3d"display:none"\x3e\x3cdiv class\x3d"ds_dialog_icon_bg"\x3e\x3c/div\x3e\x3c/td\x3e\x3ctd class\x3d"ds_dialog_main"\x3e\x3cdiv id\x3d"{id}_content" class\x3d"ds_dialog_content"\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d"2" class\x3d"ds_dialog_footer"\x3e\x3cdiv class\x3d"ds_dialog_buttons"\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e\x3c/td\x3e\x3ctd class\x3d"ds_dialog_mr"\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd class\x3d"ds_dialog_bl"\x3e\x3c/td\x3e\x3ctd class\x3d"ds_dialog_bc"\x3e\x3c/td\x3e\x3ctd class\x3d"ds_dialog_br"\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e',activeDialog:null,dialogQueue:[],addDialog:function(a){var b=this.dialogQueue;this.removeDialog(a);b.push(a);a.inQueue=!0;a.queueIndex=b.length-1},removeDialog:function(a){var b=a.queueIndex,c=this.dialogQueue;if(a.inQueue){c.splice(b,1);for(var e=c.length;b<e;b++)c[b].queueIndex--}a.inQueue=!1;a.queueIndex=-1},maskQueue:[],addMask:function(a){this.removeMask(a);this.maskQueue.push(a);a.maskIndex=this.maskQueue.length-1},removeMask:function(a){var b=a.maskIndex,c=this.maskQueue;if(a.locked){c.splice(b,1);for(var e=c.length;b<e;b++)c[b].maskIndex--}a.maskIndex=-1}});d.items={};d.defaults=t;d.currZIndex=1990;d.defaultTmpl='\x3cdiv class\x3d"ds_dialog_outer"\x3e\x3ctable class\x3d"ds_dialog_border"\x3e\x3ctr\x3e\x3ctd class\x3d"ds_dialog_tl"\x3e\x3c/td\x3e\x3ctd class\x3d"ds_dialog_tc"\x3e\x3c/td\x3e\x3ctd class\x3d"ds_dialog_tr"\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd class\x3d"ds_dialog_ml"\x3e\x3c/td\x3e\x3ctd class\x3d"ds_dialog_mc"\x3e\x3cdiv class\x3d"ds_dialog_inner"\x3e\x3ctable class\x3d"ds_dialog_panel"\x3e\x3ctr\x3e\x3ctd colspan\x3d"2" class\x3d"ds_dialog_header"\x3e\x3cdiv class\x3d"ds_dialog_title"\x3e\x3ch3\x3e\x3c/h3\x3e\x3c/div\x3e\x3cdiv class\x3d"ds_dialog_close"\x3e\x3ca href\x3d"javascript:;"\x3e\u00d7\x3c/a\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd class\x3d"ds_dialog_icon" style\x3d"display:none"\x3e\x3cdiv class\x3d"ds_dialog_icon_bg"\x3e\x3c/div\x3e\x3c/td\x3e\x3ctd class\x3d"ds_dialog_main"\x3e\x3cdiv id\x3d"{id}_content" class\x3d"ds_dialog_content"\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd colspan\x3d"2" class\x3d"ds_dialog_footer"\x3e\x3cdiv class\x3d"ds_dialog_buttons"\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e\x3c/td\x3e\x3ctd class\x3d"ds_dialog_mr"\x3e\x3c/td\x3e\x3c/tr\x3e\x3ctr\x3e\x3ctd class\x3d"ds_dialog_bl"\x3e\x3c/td\x3e\x3ctd class\x3d"ds_dialog_bc"\x3e\x3c/td\x3e\x3ctd class\x3d"ds_dialog_br"\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e\x3c/div\x3e';d.prototype={version:"2.0",constructor:d,init:function(a){var b="string"===typeof a.id?a.id:"ds_dialog_"+ ++x;if(d.items[b]){var c=d.items[b],e=c.ops,u={left:1,top:1,follow:1,onopen:1,onfocus:1,onhide:1,onclose:1,onyes:1,onno:1,esc:2,lock:2,anim:2,drag:2,fixed:2,autoOpen:2,icon:3,content:3};f.each(a,function(a,b){if(a in u&&void 0!==b){var d=u[a];2===d&&(b=!!b);b!==e[a]&&(e[a]=b,3===d&&c[a](b))}});c[e.drag?"initDrag":"releaseDrag"]();c[e.fixed?"initFixed":"releaseFixed"]();e.autoOpen&&c.show();return c}f.each(t,function(b,c){"undefined"===typeof a[b]&&(a[b]=c)});f.isArray(a.followOffset)||(a.followOffset=[0,0]);this.id=b;this.ops=a;this._getElem(a);d.items[b]=this;this._initEvent();this.padding(a.padding).size(a.width,a.height).title(a.title).button(a.buttons).icon(a.icon).content(a.content).timeout(a.timeout);"function"===typeof a.oninit&&a.oninit.call(this);a.fixed&&this.initFixed&&this.initFixed();a.drag&&this.initDrag&&this.initDrag();a.autoOpen&&this.show()},_getElem:function(a){var b=q.createElement("div");b.id=this.id;b.tabIndex=-1;b.style.position="absolute";b.className="ds_dialog"+(a.className?" "+a.className:"");b.innerHTML=d.defaultTmpl.replace(/\{id\}/g,this.id);b=this.shell=f(b);this.contentShell=b.find(".ds_dialog_content").eq(0);this.buttonShell=b.find(".ds_dialog_buttons").eq(0);this.titleShell=b.find(".ds_dialog_title").eq(0);this.closeShell=b.find(".ds_dialog_close").eq(0);this.iconShell=b.find(".ds_dialog_icon").eq(0);this.closeShell[a.showCloseButton?"show":"hide"]();var c=a.buttons;f.isArray(c)||(c=a.buttons=[]);!0!==a.onyes&&"function"!==typeof a.onyes||c.push({autoFocus:!0,text:a.yesText,className:"ds_dialog_yes",onclick:function(){return"function"===f.type(a.onyes)&&!1===a.onyes.call(this)||!a.onyes?!1:this.hide()}});!0!==a.onno&&"function"!==typeof a.onno||c.push({text:a.noText,className:"ds_dialog_no",onclick:function(){return"function"===f.type(a.onno)&&!1===a.onno.call(this)||!a.onno?!1:this.hide()}});return b},_initEvent:function(){var a=this;this.closeShell.bind("click",function(b){b.stopPropagation();b.preventDefault();a.hide()});this.shell.bind("mousedown",function(){a.focus()})},isOpen:!1,show:function(a,b){var c=this.ops,e=this.shell;this._inDOM||(this._inDOM=!0,e.appendTo("body"));this.isOpen||(c.lock&&this.lock(),!c.follow||1<=arguments.length?this.position(a||c.left,b||c.top):this.follow(c.follow,c.followOffset[0],c.followOffset[1]),c.anim?e.stop().animate({opacity:1},c.animDuration):e.stop().css("opacity",1),e.css("display","block"),this.isOpen=!0,c.onopen.call(this));return this.focus()},hide:function(){var a=this.ops;this.isOpen&&(this.isOpen=!1,!1!==a.onhide.call(this)?(this.blur().unlock(),a.anim?this.shell.stop().animate({opacity:0},a.animDuration,function(){this.style.display="none"}):this.shell.stop().hide(),d.removeDialog(this)):this.isOpen=!0);return this},focus:function(){var a=this.ops;this.isOpen&&!this.hasFocus&&!1!==a.onfocus.call(this)&&(d.activeDialog&&d.activeDialog._blur(),d.addDialog(this),a=this.shell,this.zIndex=d.currZIndex=Math.max(++d.currZIndex,this.ops.zIndex),a.addClass("ds_dialog_active").css("zIndex",this.zIndex),"focus"in a[0]&&(a[0].focus(),this.focusButton&&this.focusButton.focus()),d.activeDialog=this,this.hasFocus=!0);return this},_blur:function(){this.hasFocus=!1;this.shell.removeClass("ds_dialog_active")},blur:function(){if(this.hasFocus){this._blur();var a=d.dialogQueue,b=a.length;1<b?a[b-2].focus():d.activeDialog=null}return this},close:function(){var a=this,b=this.ops;this.shell&&!1!==b.onclose.call(this)&&(b.anim?(this.hide(),setTimeout(function(){a.destory()},b.animDuration)):this.hide().destory())},timeout:function(a){var b=this;clearTimeout(this.timer);0<~~a&&(this.timer=setTimeout(function(){b.close()},1E3*~~a));return this},destory:function(){delete d.items[this.id];this.shell&&this.shell.hide().remove();this.shell=this.contentShell=this.buttonShell=this.titleShell=this.closeShell=this.iconShell=this.focusButton=null},_getPositionLimit:function(){var a=this.ops,b=this.shell,c=b.offset(),e=h.scrollLeft(),d=h.scrollTop(),g=b.outerWidth(),b=b.outerHeight(),f=h.width(),w=h.height(),l=a.fixed?0:d,a=a.fixed?0:e;return{minTop:l,minLeft:a,maxTop:l+w-b,maxLeft:a+f-g,viewHeight:w,viewWidth:f,height:b,width:g,top:c.top,left:c.left,viewScrollTop:d,viewScrollLeft:e}},_position:function(a,b){var c=this.shell[0].style;c.left=a+"px";c.top=b+"px"},position:function(a,b){if(1>arguments.length)return this.shell.offset();var c=this.ops,e=/(\d+\.?\d+)%/,d=this._getPositionLimit();e.test(a)&&(a=(d.viewWidth-d.width)*parseFloat(RegExp.$1)/100,a+=c.fixed?0:d.viewScrollLeft);e.test(b)&&(b=(d.viewHeight-d.height)*parseFloat(RegExp.$1)/100,b+=c.fixed?0:d.viewScrollTop);a=Math.max(d.minLeft,Math.min(d.maxLeft,a));b=Math.max(d.minTop,Math.min(d.maxTop,b));this._position(a,b);return this},size:function(a,b){this.contentShell.css("width",a).css("height",b);return this},padding:function(a){this.contentShell.css("padding",a);return this},follow:function(){var a={left:function(){return 0},right:function(a,c){return c.outerWidth()-a.outerWidth()},top:function(a,c){return-a.outerHeight()},bottom:function(a,c){return c.outerHeight()}};return function(b,c,e){b=f(b);var d=f(b).offset(),g;g=this.shell;c=[c,e];a[c[0]]&&(c[0]=a[c[0]](g,b));a[c[1]]&&(c[1]=a[c[1]](g,b));g=[~~c[0],~~c[1]];this.ops.fixed&&(d.left-=h.scrollLeft(),d.top-=h.scrollTop());return this.position(d.left+g[0],d.top+g[1])}}(),title:function(a){a?(this.titleShell.html("\x3ch3\x3e"+a+"\x3c/h3\x3e"),this.titleShell.show()):this.titleShell.hide();return this},content:function(a){this.contentShell.html(a);return this.position(this.ops.left,this.ops.top)},button:function(a){var b=this,c=this.buttonShell.hide();f.isArray(a)&&0<a.length&&(f.each(a,function(a){a=q.createElement("button");a.disabled=this.disabled;a.innerHTML="\x3cspan\x3e"+this.text+"\x3c/span\x3e";a.className=this.className+(this.disabled?" disabled":"");a=f(a);var d=this.onclick;a.bind("click",function(a){a.stopPropagation();"function"===typeof d&&d.call(b,this,a)});this.autoFocus&&(b.focusButton=a);c.append(a)}),c.show());return this},icon:function(a){var b=this.iconShell;a?(b.find("div")[0].style.backgroundImage="url("+this.ops.iconBasePath+a+")",b.show()):b.hide();return this},lock:function(a,b){var c=this.ops,e=d.mask;e||(e=d.mask=new r.Mask({opacity:t.lockOpacity,background:t.lockColor,onclick:function(){var a=d.activeDialog;a&&a.ops.onmaskclick.call(a)}}));d.addMask(this);b=b||c.lockColor;e._lastBackground!==b&&(e._lastBackground=b,e._getElem().css("background",b));e.show(a||c.opacity);this.locked=!0;return this},unlock:function(){if(this.locked){d.removeMask(this);var a=d.maskQueue;0<a.length?a[a.length-1].lock():d.mask.hide();this.locked=!1}return this}};(function(){var a=/INPUT|TEXTAREA/i;v.bind("keydown",function(b){var c=d.activeDialog;c&&c.ops.esc&&27===b.keyCode&&!a.test(b.target.nodeName)&&c.hide()})})();f.extend(d.prototype,function(){var a;return{initFixed:function(){"boolean"!==typeof a&&(a=r.Mask.fixedPositionSupport());this._initFixed||(this.shell[0].style.position=a?"fixed":"absolute",this.ops.fixed=!0,a||(this.ops.fixed=!1),this._initFixed=!0);return this},releaseFixed:function(){if(this._initFixed){var a=this.position(),c=h.scrollLeft(),d=h.scrollTop();this.position(a.left+c,a.top+d);this.shell[0].style.position="absolute";this.ops.fixed=!1}return this}}}());f.extend(d.prototype,function(){var a=q.documentElement,b="setCapture"in a,c="onlosecapture"in a,e="getSelection"in p?function(){p.getSelection().removeAllRanges()}:function(){q.selection&&q.selection.empty()},u=function(a,b){var c=a.contentShell[0],d=a.closeShell[0];return b==c||f.contains(c,b)||b===d||f.contains(d,b)||f.contains(a.buttonShell[0],b)?!0:!1};return{initDrag:function(){if(!this._dragHandler){var a=this;this._dragHandler=function(f){if(!(0!==f.button&&1!==f.button||u(a,f.target))){var g=a.ops,l=a.shell,m=a._getPositionLimit(),k=d._currDrag={limit:m,dialog:a,offsetTop:f.pageY-m.top,offsetLeft:f.pageX-m.left,onmousemove:function(b){var c=b.pageY-k.offsetTop;b=b.pageX-k.offsetLeft;c-=g.fixed?m.viewScrollTop:0;b-=g.fixed?m.viewScrollLeft:0;c=Math.min(m.maxTop,c);b=Math.min(m.maxLeft,b);g.top=Math.max(m.minTop,c);g.left=Math.max(m.minLeft,b);a._position(g.left,g.top);e()},onmouseup:function(){b&&l[0].releaseCapture();c?l.unbind("losecapture",k.onmouseup):h.unbind("blur",k.onmouseup);v.unbind("mousemove",k.onmousemove).unbind("mouseup",k.onmouseup);l.removeClass("ds_dialog_drag");d._currDrag=null}};c?l.bind("losecapture",k.onmouseup):h.bind("blur",k.onmouseup);b&&l[0].setCapture();v.bind("mousemove",k.onmousemove).bind("mouseup",k.onmouseup);l.addClass("ds_dialog_drag");return!1}};this.shell.bind("mousedown",this._dragHandler)}return this},releaseDrag:function(){this._dragHandler&&(this.shell.unbind("mousedown",this._dragHandler),this._dragHandler=null);return this}}}());r.dialog=function(a,b,c){"string"===typeof a&&(a={content:a,title:b||"\u6d88\u606f\u63d0\u793a",onyes:b,onno:c});return new d(a||{})};f.extend(r.dialog,{items:d.items,alert:function(a,b,c){"string"===typeof b&&(c=b);return new d({id:"ds_dialog_alert",fixed:!0,left:"50%",top:"40%",icon:c?c:"info.png",title:"\u6d88\u606f\u63d0\u793a",content:a,buttons:[{text:"\u786e\u5b9a",autoFocus:!0,className:"ds_dialog_yes",onclick:function(){this.close()}}],onhide:"function"===typeof b?b:function(){}})},confirm:function(a,b,c,e){return new d({id:"ds_dialog_confirm",fixed:!0,left:"50%",top:"40%",icon:"confirm.png",title:"\u6d88\u606f\u786e\u8ba4",content:a,onyes:b||!0,onhide:e,onno:c||!0})},prompt:function(a,b,c){return new d({id:"ds_dialog_prompt",fixed:!0,left:"50%",top:"40%",icon:"confirm.png",title:"\u6d88\u606f\u786e\u8ba4",content:'\x3cp style\x3d"margin:0;padding:0 0 5px;"\x3e'+a+'\x3c/p\x3e\x3cdiv\x3e\x3cinput type\x3d"text" style\x3d"color:#333;font-size:12px;padding:.42em .33em;width:18em;" /\x3e\x3c/div\x3e',onopen:function(){var a=this,b=this._input;b||(b=this._input=this.contentShell.find("input"),b.bind("keydown",function(b){if(13===b.keyCode&&a.focusButton)return a.focusButton.trigger("click"),!1}));b.val(c||"")},onfocus:function(){var a=this._input[0];setTimeout(function(){a.select();a.focus()},32)},onclose:function(){this._input=null},onyes:function(){var a=this._input[0];return"function"===typeof b?b.call(this,a.value,a):void 0},onno:!0})},tips:function(a,b,c,e){"boolean"===typeof c&&(e=c,c=null);return new d({id:"ds_dialog_tips",fixed:!0,esc:!1,lock:!!e,follow:c,followOffset:[0,"bottom"],drag:!1,content:a,padding:"12px 50px",showCloseButton:!1,timeout:b||0})}})})(this,this.document,jQuery);
//jquery.fly   https://github.com/amibug/fly
!function(a){a.fly=function(b,c){var d={version:"1.0.0",autoPlay:!0,vertex_Rtop:20,speed:1.2,start:{},end:{},onEnd:a.noop},e=this,f=a(b);e.init=function(a){this.setOptions(a),!!this.settings.autoPlay&&this.play()},e.setOptions=function(b){this.settings=a.extend(!0,{},d,b);var c=this.settings,e=c.start,g=c.end;f.css({marginTop:"0px",marginLeft:"0px",position:"fixed"}).appendTo("body"),null!=g.width&&null!=g.height&&a.extend(!0,e,{width:f.width(),height:f.height()});var h=Math.min(e.top,g.top)-Math.abs(e.left-g.left)/3;h<c.vertex_Rtop&&(h=Math.min(c.vertex_Rtop,Math.min(e.top,g.top)));var i=Math.sqrt(Math.pow(e.top-g.top,2)+Math.pow(e.left-g.left,2)),j=Math.ceil(Math.min(Math.max(Math.log(i)/.05-75,30),100)/c.speed),k=e.top==h?0:-Math.sqrt((g.top-h)/(e.top-h)),l=(k*e.left-g.left)/(k-1),m=g.left==l?0:(g.top-h)/Math.pow(g.left-l,2);a.extend(!0,c,{count:-1,steps:j,vertex_left:l,vertex_top:h,curvature:m})},e.play=function(){this.move()},e.move=function(){var b=this.settings,c=b.start,d=b.count,e=b.steps,g=b.end,h=c.left+(g.left-c.left)*d/e,i=0==b.curvature?c.top+(g.top-c.top)*d/e:b.curvature*Math.pow(h-b.vertex_left,2)+b.vertex_top;if(null!=g.width&&null!=g.height){var j=e/2,k=g.width-(g.width-c.width)*Math.cos(j>d?0:(d-j)/(e-j)*Math.PI/2),l=g.height-(g.height-c.height)*Math.cos(j>d?0:(d-j)/(e-j)*Math.PI/2);f.css({width:k+"px",height:l+"px","font-size":Math.min(k,l)+"px"})}f.css({left:h+"px",top:i+"px"}),b.count++;var m=window.requestAnimationFrame(a.proxy(this.move,this));d==e&&(window.cancelAnimationFrame(m),b.onEnd.apply(this))},e.destroy=function(){f.remove()},e.init(c)},a.fn.fly=function(b){return this.each(function(){void 0==a(this).data("fly")&&a(this).data("fly",new a.fly(this,b))})}}(jQuery);
//sidebar
jQuery(function(d){function g(){clearTimeout(h);h=setTimeout(q,160)}function r(){quickShell[1340<e.width()?"removeClass":"addClass"]("sidebar-box-dockright")}function k(){clearTimeout(l);l=setTimeout(r,160)}function q(){100<e.scrollTop()?quickPanel.addClass("li-gotop"):quickPanel.removeClass("li-gotop")}var c,a,t=d(document),f=!1,m=function(){a&&a.removeClass("current");f=!1;c="";quickPop.hide();quickPop.animate({left:0,queue:!0})},u=function(b){quickPopXHR&&quickPopXHR.abort&&quickPopXHR.abort();if(b!==c){var a=quickDataFns[b];quickPop.html(ds.tmpl(popTmpl,a));a.init.call(this,a)}t.unbind("click.sidebar-box").one("click.sidebar-box",m);quickPop[0].className="sidebar-box-pop quick_"+b;f=!0;c=b;quickPop.show();quickPop.animate({left:-320,queue:!0})};quickShell.bind("click.sidebar-box",function(a){a.stopPropagation()});quickPop.delegate("a.bar-close","click",function(){quickPop.hide();quickPop.animate({left:280,queue:!0});a&&a.removeClass("current")});var e=d(window),v=!!ds.getCookie("ql_collapse"),n=function(){var b=this.className.replace(/current/g,"").replace(/\s+/,"");if(f&&b===c)return m();u(this.className);a&&a.removeClass("current");a=d(this).addClass("current")},p={my_qlinks:n,cartbox:n,return_top:function(){ds.scrollTo(0,0);quickPanel.removeClass("li-gotop")}};quickShell.delegate("a","click",function(a){var b=this.className.replace(/current/g,"").replace(/\s+/,"");b&&p[b]&&(p[b].call(this),a.preventDefault())});var h,l;e.bind("scroll.go_top",g).bind("resize.sidebar-box",k);v&&quickShell.addClass("sidebar-box-min");g();k()});
//RequestAnimationFrame & flying
if($(".sidebar-box li").hasClass("li-shopcart")&&"Microsoft Internet Explorer"==navigator.appName&&("MSIE6.0"==navigator.appVersion.split(";")[1].replace(/[ ]/g,"")||"Microsoft Internet Explorer"==navigator.appName&&"MSIE7.0"==navigator.appVersion.split(";")[1].replace(/[ ]/g,"")||"Microsoft Internet Explorer"==navigator.appName&&"MSIE8.0"==navigator.appVersion.split(";")[1].replace(/[ ]/g,""))){for(var lastTime=0,vendors=["webkit","moz"],x=0;x<vendors.length&&!window.requestAnimationFrame;++x)window.requestAnimationFrame=window[vendors[x]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[vendors[x]+"CancelAnimationFrame"]||window[vendors[x]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(a,e){var b=(new Date).getTime(),c=Math.max(0,16-(b-lastTime)),d=window.setTimeout(function(){a(b+c)},c);lastTime=b+c;return d});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})};
//sidebar config
(function ($) {
    $('.shopcart-list').height($(window).height() - 85);
    $(".sidebar-box li").mouseenter(function() {
        $(this).find(".bar-tips").animate({left:-92,queue:true});
        $(this).find(".bar-tips").css("visibility","visible");
    }).mouseleave(function() {
        $(this).find(".bar-tips").css("visibility","hidden");
        $(this).find(".bar-tips").animate({left:-121,queue:true});
    });
    var offset = $(".bar-num").offset();  //结束的地方的元素
    $(".addcar").click(function(event){   //是$(".addcar")这个元素点击促发的 开始动画的位置就是这个元素的位置为起点
        var addcar = $(this);
        var addimg = addcar.parent().find('img').attr('src');
        var flyer = $('<img class="fly-img" src="'+ addimg +'">');
        flyer.fly({
            start: {
                left: event.pageX,
                top: event.pageY
            },
            end: {
                left: offset.left+10,
                top: offset.top+10,
                width: 0,
                height: 0
            },
            onEnd: function(){
                $(".bar-num").text(Number($(".bar-num").text())+1);
                addcar.css("cursor","default").removeClass('btn-primary').unbind('click');
                this.destory();
            }
        });
    });
})(jQuery);